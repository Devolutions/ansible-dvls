---
- name: Fetch DVLS
  hosts: localhost
  vars_files:
    - secrets.yml
  tasks:
    - name: Fetch all secrets
      devolutions.dvls.fetch_secrets:
        server_base_url: "{{ lookup('env', 'DVLS_SERVER_BASE_URL') }}"
        app_key: "{{ lookup('env', 'DVLS_APP_KEY') }}"
        app_secret: "{{ lookup('env', 'DVLS_APP_SECRET') }}"
        vault_id: "{{ lookup('env', 'DVLS_VAULT_ID') }}"

    - name: Fetch secrets using file
      devolutions.dvls.fetch_secrets:
        server_base_url: "{{ lookup('env', 'DVLS_SERVER_BASE_URL') }}"
        app_key: "{{ lookup('env', 'DVLS_APP_KEY') }}"
        app_secret: "{{ lookup('env', 'DVLS_APP_SECRET') }}"
        vault_id: "{{ lookup('env', 'DVLS_VAULT_ID') }}"
        secrets: "{{ secrets }}"

    - name: Get secret from ID
      devolutions.dvls.fetch_secrets:
        server_base_url: "{{ lookup('env', 'DVLS_SERVER_BASE_URL') }}"
        app_key: "{{ lookup('env', 'DVLS_APP_KEY') }}"
        app_secret: "{{ lookup('env', 'DVLS_APP_SECRET') }}"
        vault_id: "{{ lookup('env', 'DVLS_VAULT_ID') }}"
        secrets:
          - secret_id: 08a6526d-1f86-40e2-aef1-a74cc31a548d

    - name: Get secret from name
      devolutions.dvls.fetch_secrets:
        server_base_url: "{{ lookup('env', 'DVLS_SERVER_BASE_URL') }}"
        app_key: "{{ lookup('env', 'DVLS_APP_KEY') }}"
        app_secret: "{{ lookup('env', 'DVLS_APP_SECRET') }}"
        vault_id: "{{ lookup('env', 'DVLS_VAULT_ID') }}"
        secrets:
          - secret_name: AzureSP

    - name: Get secret from Folder
      devolutions.dvls.fetch_secrets:
        server_base_url: "{{ lookup('env', 'DVLS_SERVER_BASE_URL') }}"
        app_key: "{{ lookup('env', 'DVLS_APP_KEY') }}"
        app_secret: "{{ lookup('env', 'DVLS_APP_SECRET') }}"
        vault_id: "{{ lookup('env', 'DVLS_VAULT_ID') }}"
        secrets:
          - secret_path: Test-Ansible

    - name: Get secret from Tag
      devolutions.dvls.fetch_secrets:
        server_base_url: "{{ lookup('env', 'DVLS_SERVER_BASE_URL') }}"
        app_key: "{{ lookup('env', 'DVLS_APP_KEY') }}"
        app_secret: "{{ lookup('env', 'DVLS_APP_SECRET') }}"
        vault_id: "{{ lookup('env', 'DVLS_VAULT_ID') }}"
        secrets:
          - secret_tag: tag

    - name: Get secret from Type
      devolutions.dvls.fetch_secrets:
        server_base_url: "{{ lookup('env', 'DVLS_SERVER_BASE_URL') }}"
        app_key: "{{ lookup('env', 'DVLS_APP_KEY') }}"
        app_secret: "{{ lookup('env', 'DVLS_APP_SECRET') }}"
        vault_id: "{{ lookup('env', 'DVLS_VAULT_ID') }}"
        secrets:
          - secret_type: Credential
