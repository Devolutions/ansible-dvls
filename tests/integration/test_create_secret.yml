---
- name: Fetch DVLS
  hosts: localhost
  tasks:
    - name: Create secret using default value
      devolutions.dvls.create_secret:
        server_base_url: "{{ lookup('env', 'DVLS_SERVER_BASE_URL') }}"
        app_key: "{{ lookup('env', 'DVLS_APP_KEY') }}"
        app_secret: "{{ lookup('env', 'DVLS_APP_SECRET') }}"
        vault_id: "{{ lookup('env', 'DVLS_VAULT_ID') }}"
        secret:
          secret_path: "Test-Ansible\\create-secrets"
          secret_name: "{{ now(fmt='%Y-%m-%d_%H-%M-%S') }}"
          value: "{{ now(fmt='%Y-%m-%d_%H-%M-%S') }}"

    - name: Create secret specifying value
      devolutions.dvls.create_secret:
        server_base_url: "{{ lookup('env', 'DVLS_SERVER_BASE_URL') }}"
        app_key: "{{ lookup('env', 'DVLS_APP_KEY') }}"
        app_secret: "{{ lookup('env', 'DVLS_APP_SECRET') }}"
        vault_id: "{{ lookup('env', 'DVLS_VAULT_ID') }}"
        secret:
          secret_path: "Test-Ansible\\create-secrets"
          secret_type: "Credential"
          secret_subtype: "Default"
          secret_name: "{{ now(fmt='%Y-%m-%d_%H-%M-%S') }}"
          value: "{{ now(fmt='%Y-%m-%d_%H-%M-%S') }}"

    - name: Updating an already existing secret
      devolutions.dvls.create_secret:
        server_base_url: "{{ lookup('env', 'DVLS_SERVER_BASE_URL') }}"
        app_key: "{{ lookup('env', 'DVLS_APP_KEY') }}"
        app_secret: "{{ lookup('env', 'DVLS_APP_SECRET') }}"
        vault_id: "{{ lookup('env', 'DVLS_VAULT_ID') }}"
        secret:
          secret_path: "Test-Ansible"
          secret_name: "Default"
          value: "{{ now(fmt='%Y-%m-%d_%H-%M-%S') }}"
